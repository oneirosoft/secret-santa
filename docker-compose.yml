services:
  api:
    build:
      context: .
      dockerfile: apps/api/Dockerfile
    container_name: secret-santa-api
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - PORT=3000
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:3000/"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  # Placeholder for Azure Data Tables emulator (Azurite)
  # Uncomment when ready to use
  # azurite:
  #   image: mcr.microsoft.com/azure-storage/azurite:latest
  #   container_name: secret-santa-azurite
  #   ports:
  #     - "10000:10000"  # Blob service
  #     - "10001:10001"  # Queue service
  #     - "10002:10002"  # Table service
  #   volumes:
  #     - azurite-data:/data
  #   command: azurite --blobHost 0.0.0.0 --queueHost 0.0.0.0 --tableHost 0.0.0.0 --loose
  #   restart: unless-stopped
  #   environment:
  #     - AZURITE_ACCOUNTS=devstoreaccount1:Eby8vdM02xNOcqFlqUwJPLlmEtlCDXJ1OUzFT50uSRZ6IFsuFq2UVErCz4I6tq/K1SZFPTOtr/KBHBeksoGMGw==

  # Placeholder for UI container
  # web:
  #   build:
  #     context: .
  #     dockerfile: apps/web/Dockerfile
  #   container_name: secret-santa-web
  #   ports:
  #     - "3001:3000"
  #   environment:
  #     - NODE_ENV=production
  #     - NEXT_PUBLIC_API_URL=http://api:3000
  #   depends_on:
  #     - api
  #   restart: unless-stopped

# volumes:
#   azurite-data:
#     driver: local
